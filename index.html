<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Freechatbook - Reels, Share & Badges</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body { background-color: #f0f2f5; font-family: 'Inter', sans-serif; }
        .hidden { display: none !important; }
        .post-card { background: white; border-radius: 12px; margin-bottom: 12px; box-shadow: 0 1px 2px rgba(0,0,0,0.1); }
        .badge-blue { color: #0866FF; }
        .badge-green { color: #28a745; }
        .reel-box { height: 80vh; background: #000; position: relative; border-radius: 20px; overflow: hidden; margin-bottom: 20px; }
        .reel-actions { position: absolute; right: 15px; bottom: 100px; display: flex; flex-direction: column; gap: 20px; color: white; text-align: center; }
    </style>
</head>
<body>

    <nav class="bg-white sticky top-0 border-b p-3 flex justify-between items-center px-6 shadow-sm z-50">
        <h1 class="text-[#0866FF] text-2xl font-black italic">Freechatbook</h1>
        <div class="flex gap-4">
            <i onclick="showSection('reels')" class="fas fa-play-circle text-2xl text-red-500 cursor-pointer"></i>
            <img id="navPfp" onclick="showSection('profile')" src="" class="w-9 h-9 rounded-full border-2 border-blue-500 object-cover cursor-pointer">
        </div>
    </nav>

    <div class="max-w-xl mx-auto p-3 pb-24">
        
        <div id="feedSection">
            <div id="feed"></div>
        </div>

        <div id="reelsSection" class="hidden">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold">Reels</h2>
                <button onclick="document.getElementById('reelFile').click()" class="bg-blue-600 text-white px-4 py-1 rounded-full text-xs font-bold">আপলোড</button>
                <input type="file" id="reelFile" class="hidden" accept="video/*" onchange="uploadReel(this)">
            </div>
            <div id="reelList" class="space-y-6"></div>
        </div>

        <div id="profileSection" class="hidden">
            <div class="bg-white p-6 rounded-2xl shadow-sm text-center mb-4">
                <img id="profilePfp" src="" class="w-28 h-28 rounded-full mx-auto border-4 border-blue-100 object-cover">
                <h2 class="text-2xl font-bold mt-3 flex justify-center items-center gap-1">
                    <span id="pName">Name</span>
                    <i id="vBadge" class="fas fa-check-circle"></i>
                </h2>
                <p id="fCount" class="text-blue-600 font-bold text-sm">0 Followers</p>
                
                <div class="flex justify-center gap-3 mt-4">
                    <button onclick="shareLink('WhatsApp', 'Check out this profile on Freechatbook!')" class="text-green-500"><i class="fab fa-whatsapp text-2xl"></i></button>
                    <button onclick="shareLink('Facebook', '')" class="text-blue-600"><i class="fab fa-facebook text-2xl"></i></button>
                    <button onclick="shareLink('Imo', '')" class="text-blue-400 font-bold">Imo</button>
                </div>

                <div class="mt-6 flex justify-center gap-2">
                    <button onclick="logout()" class="bg-red-50 text-red-600 px-6 py-2 rounded-lg font-bold text-sm w-full">লগআউট</button>
                </div>
            </div>
            <div id="myPosts"></div>
        </div>
    </div>

    <div class="fixed bottom-0 left-0 right-0 bg-white border-t flex justify-around p-3 z-50">
        <i onclick="showSection('feed')" class="fas fa-home text-xl text-gray-400 cursor-pointer"></i>
        <i onclick="showSection('inbox')" class="fas fa-comment-dots text-xl text-gray-400 cursor-pointer"></i>
        <i onclick="showSection('reels')" class="fas fa-play text-xl text-gray-400 cursor-pointer"></i>
        <i onclick="showSection('menu')" class="fas fa-plus-square text-xl text-gray-400 cursor-pointer"></i>
        <i onclick="showSection('profile')" class="fas fa-user-circle text-xl text-gray-400 cursor-pointer"></i>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyDlrDXIji286w0wBPqta0mftEhPxS3M9BM",
            authDomain: "freechatbook-42f04.firebaseapp.com",
            databaseURL: "https://freechatbook-42f04-default-rtdb.firebaseio.com",
            projectId: "freechatbook-42f04",
            storageBucket: "freechatbook-42f04.firebasestorage.app",
            messagingSenderId: "784680329144",
            appId: "1:784680329144:web:ccacf6e9d71fd25772394d"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        let user = JSON.parse(localStorage.getItem('freechatbook_user'));

        function showSection(id) {
            ['feed', 'reels', 'profile'].forEach(s => {
                const el = document.getElementById(s + 'Section');
                if(el) el.classList.add('hidden');
            });
            document.getElementById(id + 'Section').classList.remove('hidden');
            if(id === 'reels') loadReels();
            if(id === 'profile') updateProfile();
        }

        // --- শেয়ার ফিচার (WhatsApp, FB, Imo) ---
        function shareLink(platform, msg) {
            const url = window.location.href;
            const text = encodeURIComponent(msg + " " + url);
            let shareUrl = "";

            if(platform === 'WhatsApp') shareUrl = `https://api.whatsapp.com/send?text=${text}`;
            if(platform === 'Facebook') shareUrl = `https://www.facebook.com/sharer/sharer.php?u=${url}`;
            if(platform === 'Imo') shareUrl = `https://www.imo.im/share?url=${url}&title=${text}`; // ডামি লিঙ্ক, ইমো অ্যাপ ডিপলিঙ্ক ব্যবহার করে

            window.open(shareUrl, '_blank');
        }

        // --- রিলস আপডেট (রিয়েক্ট ও কমেন্ট) ---
        function uploadReel(input) {
            const file = input.files[0];
            const reader = new FileReader();
            reader.onload = e => {
                db.ref('reels').push({
                    uName: user.name, uPfp: user.pfp, video: e.target.result,
                    likes: 0, time: Date.now()
                });
                alert("রিলস আপলোড হয়েছে!");
            };
            reader.readAsDataURL(file);
        }

        function loadReels() {
            db.ref('reels').on('value', snap => {
                const list = document.getElementById('reelList'); list.innerHTML = '';
                snap.forEach(c => {
                    const r = c.val();
                    list.innerHTML += `
                        <div class="reel-box">
                            <video src="${r.video}" class="w-full h-full object-cover" loop onclick="this.paused?this.play():this.pause()"></video>
                            <div class="reel-actions">
                                <div onclick="alert('Liked!')"><i class="fas fa-heart text-2xl"></i><p class="text-[10px]">${r.likes}</p></div>
                                <div onclick="prompt('Comment:')"><i class="fas fa-comment text-2xl"></i><p class="text-[10px]">Reply</p></div>
                                <div onclick="shareLink('WhatsApp', 'দেখুন এই চমৎকার রিলসটি!')"><i class="fas fa-share text-2xl text-green-400"></i></div>
                            </div>
                            <div class="absolute bottom-4 left-4 text-white">
                                <h4 class="font-bold">@${r.uName}</h4>
                            </div>
                        </div>`;
                });
            });
        }

        // --- ফিড ও শেয়ার পোস্ট ---
        function loadFeed() {
            db.ref('posts').on('value', snap => {
                const f = document.getElementById('feed'); f.innerHTML = '';
                snap.forEach(c => {
                    const p = c.val();
                    f.innerHTML = `
                        <div class="post-card p-4">
                            <div class="flex items-center gap-2 mb-3">
                                <img src="${p.uPfp}" class="w-9 h-9 rounded-full">
                                <h4 class="font-bold text-sm">${p.uName}</h4>
                            </div>
                            <p class="text-sm mb-2">${p.content}</p>
                            ${p.image ? `<img src="${p.image}" class="w-full rounded-lg mb-3">` : ''}
                            <div class="flex justify-between border-t pt-3 text-gray-500 font-bold text-xs">
                                <div onclick="alert('Liked!')"><i class="far fa-thumbs-up"></i> Like</div>
                                <div onclick="shareLink('WhatsApp', 'ফ্রিচ্যাটবুক-এ এই পোস্টটি দেখুন!')"><i class="fas fa-share"></i> Share to WhatsApp</div>
                            </div>
                        </div>` + f.innerHTML;
                });
            });
        }

        function updateProfile() {
            document.getElementById('pName').innerText = user.name;
            document.getElementById('profilePfp').src = user.pfp;
            document.getElementById('fCount').innerText = (user.followers || 0) + " Followers";
            
            // ব্যাজ লজিক (প্রথম ১০০ ব্লু, ১০০০ ফলোয়ার সবুজ)
            db.ref('users/' + user.name).once('value', snap => {
                const d = snap.val();
                const v = document.getElementById('vBadge');
                if(d.followers >= 1000) v.className = "fas fa-check-circle badge-green";
                else if(d.joinIndex < 100) v.className = "fas fa-check-circle badge-blue";
                else v.classList.add('hidden');
            });
        }

        function logout() { localStorage.clear(); location.reload(); }

        if(user) {
            document.getElementById('navPfp').src = user.pfp;
            loadFeed();
        }
    </script>
</body>
</html>
