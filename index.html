<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Freechatbook - Stable Version</title>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
body{background:#f0f2f5;font-family:Segoe UI}
.hidden{display:none}
.post-card{background:#fff;border-radius:14px;padding:15px;box-shadow:0 1px 2px rgba(0,0,0,.1);margin-bottom:12px}
.active-nav{color:#0866FF}
.verify-badge{color:#000;font-size:13px;margin-left:4px}
.reel-video{height:75vh;width:100%;object-fit:cover;border-radius:16px}
</style>
</head>

<body>

<div id="app">

<nav class="bg-white p-3 flex justify-between items-center sticky top-0 z-50">
<h1 class="text-blue-600 text-2xl font-black italic">Freechatbook</h1>
<img id="navPfp" class="w-9 h-9 rounded-full cursor-pointer" onclick="show('profile')">
</nav>

<div class="max-w-xl mx-auto p-3 pb-24">

<div id="feed">
<div id="feedList"></div>
</div>

<div id="reels" class="hidden">
<div id="reelList" class="space-y-6"></div>
</div>

<div id="profile" class="hidden bg-white p-6 rounded-2xl text-center">
<img id="profilePfp" class="w-28 h-28 mx-auto rounded-full border-4 border-blue-500">
<h2 id="profileName" class="text-xl font-bold mt-2"></h2>
<p id="profileFollowers" class="text-sm text-blue-600"></p>
<button onclick="logout()" class="mt-4 bg-red-100 text-red-600 px-6 py-2 rounded-lg">Logout</button>
</div>

</div>

<div class="fixed bottom-0 w-full bg-white border-t flex justify-around p-3">
<i onclick="show('feed')" class="fas fa-home text-xl"></i>
<i onclick="show('reels')" class="fas fa-play-circle text-xl"></i>
<i onclick="openPost()" class="fas fa-plus-square text-xl"></i>
<i onclick="show('profile')" class="fas fa-user text-xl"></i>
</div>

</div>

<div id="postModal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center">
<div class="bg-white p-6 w-full max-w-md rounded-xl">
<textarea id="postText" class="w-full p-3 bg-gray-100 rounded-xl" placeholder="কি ভাবছেন?"></textarea>
<button onclick="post()" class="w-full mt-3 bg-blue-600 text-white py-2 rounded-xl">Post</button>
</div>
</div>

<script>
firebase.initializeApp({
apiKey:"AIzaSyDlrDXIji286w0wBPqta0mftEhPxS3M9BM",
authDomain:"freechatbook-42f04.firebaseapp.com",
databaseURL:"https://freechatbook-42f04-default-rtdb.firebaseio.com",
projectId:"freechatbook-42f04"
});
const db=firebase.database();

const feedList=document.getElementById("feedList");
const reelList=document.getElementById("reelList");
const postModal=document.getElementById("postModal");
const postText=document.getElementById("postText");

let user=JSON.parse(localStorage.getItem("freechat_user"));

if(!user){
let name=prompt("Username দিন");
if(!name) location.reload();
user={name,pfp:"https://i.imgur.com/6VBx3io.png"};
localStorage.setItem("freechat_user",JSON.stringify(user));
db.ref("users/"+name).set(user);
}

document.getElementById("navPfp").src=user.pfp;

function escapeHTML(t=""){return t.replace(/[&<>]/g,m=>({"&":"&amp;","<":"&lt;",">":"&gt;"}[m]))}

function loadFeed(){
db.ref("posts").on("value",s=>{
feedList.innerHTML="";
let a=[];
s.forEach(c=>a.push(c.val()));
a.reverse().forEach(p=>{
feedList.innerHTML+=`
<div class="post-card">
<b>${p.u} <i class="fas fa-check-circle verify-badge"></i></b>
<p class="mt-2">${escapeHTML(p.t)}</p>
</div>`;
});
});
}

function post(){
if(!postText.value.trim())return;
db.ref("posts").push({u:user.name,t:postText.value});
postText.value="";
postModal.classList.add("hidden");
}

function openPost(){postModal.classList.remove("hidden")}

function show(id){
["feed","reels","profile"].forEach(s=>document.getElementById(s).classList.add("hidden"));
document.getElementById(id).classList.remove("hidden");
if(id==="profile"){
profileName.innerHTML=user.name+' <i class="fas fa-check-circle verify-badge"></i>';
profilePfp.src=user.pfp;
}
}

function logout(){
localStorage.clear();
location.reload();
}

loadFeed();
show("feed");
</script>

</body>
</html>
